<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Canvas Coordinate Picker</title>
  <style>
    body { margin: 8; overflow: hidden; }
    #info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      font-family: sans-serif;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <div id="info">Click to get coordinates</div>
  <canvas id="canvas"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const info = document.getElementById('info');

    // フルスクリーン対応
    canvas.width = window.innerWidth - 16;
    canvas.height = window.innerHeight - 16;

    const spacing = 100;

    function drawGridAndLabels(ctx, width, height, spacing) {
      ctx.clearRect(0, 0, width, height);
      ctx.strokeStyle = '#cccccc';
      ctx.fillStyle = '#000000';
      ctx.font = '12px sans-serif';

      for (let x = 0; x < width; x += spacing) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, height);
        ctx.stroke();
        ctx.fillText(x.toString(), x + 2, 12);
      }

      for (let y = 0; y < height; y += spacing) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(width, y);
        ctx.stroke();
        ctx.fillText(y.toString(), 2, y - 2);
      }
    }

    drawGridAndLabels(ctx, canvas.width, canvas.height, spacing);

    // クリックイベント
    canvas.addEventListener('click', (event) => {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      info.innerText = `x=${Math.round(x)}, y=${Math.round(y)}`;
      console.log(`Clicked at: x=${x}, y=${y}`);

      drawGridAndLabels(ctx, canvas.width, canvas.height, spacing);

      // クリックした場所に点を描く
      ctx.beginPath();
      ctx.arc(x, y, 20, 0, 2 * Math.PI);
      ctx.fillStyle = 'red';
      ctx.fill();

      // サーバーに送信（必要に応じて有効化）
      /*
      fetch('/api/send-coordinate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ x, y })
      });
      */
    });
  </script>
</body>
</html>
